name: Update ARTEC M3U
on:
  schedule:
    # Her saatin 0. dakikasÄ±nda (saat baÅŸÄ±nda) Ã§alÄ±ÅŸÄ±r (GÃ¼nde 24 kez)
    - cron: '0 * * * *'
  workflow_dispatch:
    # Depo sayfasÄ±ndan manuel olarak Ã§alÄ±ÅŸtÄ±rmaya izin verir

jobs:
  update-m3u:
    permissions:
      contents: write # âœ… Mutlaka olmasÄ± gereken dosya yazma izni
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Depoyu Ã‡ek
        uses: actions/checkout@v4
        with:
          # Yetkilendirme iÃ§in GITHUB_TOKEN'i aÃ§Ä±kÃ§a kullan.
          token: ${{ secrets.GITHUB_TOKEN }} 

      - name: ğŸ“¦ M3U Ä°Ã§eriÄŸini PHP URL'den Ã‡ekme
        id: fetch_m3u
        run: |
          # DÄ°KKAT: AÅŸaÄŸÄ±daki URL'yi kendi Worker URL'niz ile deÄŸiÅŸtirin
          PHP_URL="http://sultansmart.byethost11.com/Digital.php?ID=https://artec.tv/"
          
          # curl komutuna bir User-Agent eklenerek Ã§ekim denenecek
          curl -sS -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "$PHP_URL" > ARTEC.m3u
          
      - name: âš™ï¸ DeÄŸiÅŸiklik Var mÄ± Kontrol Et
        id: git_status
        # ARTEC.m3u dosyasÄ±nda bir deÄŸiÅŸiklik olup olmadÄ±ÄŸÄ±nÄ± kontrol eder
        run: echo "changes=$(git status --porcelain ARTEC.m3u)" >> $GITHUB_OUTPUT

      - name: â¬†ï¸ DeÄŸiÅŸiklikleri Kaydet (Commit) ve GÃ¶nder (Push)
        # Sadece deÄŸiÅŸiklik varsa commit ve push yapar
        if: ${{ steps.git_status.outputs.changes != '' }}
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "action@github.com"
          git add ARTEC.m3u
          git commit -m "Auto update: Fetch latest ARTEC M3U from Worker"
          # ğŸš¨ Ã‡Ã–ZÃœM BURADA: Ã–nce depodaki son deÄŸiÅŸiklikleri Ã§ek
          git pull --rebase
          git push