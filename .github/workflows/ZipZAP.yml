steps:
  - name: â¬‡ï¸ Depoyu Ã‡ek
    uses: actions/checkout@v4
    with:
      token: ${{ secrets.GITHUB_TOKEN }}

  - name: ğŸ“¦ M3U Ä°Ã§eriÄŸini PHP URL'den Ã‡ek
    id: fetch_m3u
    run: |
      PHP_URL="http://sultansmart.byethost11.com/Digital.php?ID=https://zipzaptv.com/"
      M3U_FILE="ZipZAP.m3u"
      echo "ğŸ”— Veri Ã§ekiliyor: $PHP_URL"

      # -f: HTTP hatasÄ± durumunda baÅŸarÄ±sÄ±z ol (4xx/5xx)
      # -sS: Sessiz Ã§alÄ±ÅŸ, ancak hata durumunda gÃ¶ster
      curl -L -f -sS -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" "$PHP_URL" -o "$M3U_FILE"
      
      # DosyanÄ±n indirildiÄŸini ve boÅŸ olmadÄ±ÄŸÄ±nÄ± kontrol et
      FILE_SIZE=$(wc -c < "$M3U_FILE")
      if [ "$FILE_SIZE" -lt 100 ]; then
        echo "âŒ Hata: Ä°ndirilen dosya ($M3U_FILE) Ã§ok kÃ¼Ã§Ã¼k ($FILE_SIZE bayt) veya boÅŸ. OlasÄ±lÄ±kla sunucu hata dÃ¶ndÃ¼rdÃ¼."
        rm "$M3U_FILE" # GeÃ§ersiz dosyayÄ± kaldÄ±r
        exit 1
      fi

      echo "âœ… Dosya baÅŸarÄ±yla indirildi ($FILE_SIZE bayt)."
      echo "ğŸ“ Ä°lk 10 satÄ±r:"
      head -n 10 "$M3U_FILE"

  - name: âš™ï¸ DeÄŸiÅŸiklik Var mÄ± Kontrol Et
    id: git_status
    # Dosya yoksa veya deÄŸiÅŸtiyse git diff false dÃ¶ndÃ¼rÃ¼r.
    run: |
      if git diff --quiet ZipZAP.m3u; then
        echo "changes=false" >> $GITHUB_OUTPUT
        echo "â„¹ï¸ Dosyada deÄŸiÅŸiklik yok, commit atlanÄ±yor."
      else
        echo "changes=true" >> $GITHUB_OUTPUT
        echo "âš ï¸ Dosyada deÄŸiÅŸiklik bulundu, commit hazÄ±rlanÄ±yor."
      fi

  - name: â¬†ï¸ DeÄŸiÅŸiklikleri Commit ve Push Et
    if: ${{ steps.git_status.outputs.changes == 'true' }}
    run: |
      git config user.name "GitHub Actions Bot"
      git config user.email "action@github.com"
      git add ZipZAP.m3u
      git commit -m "Auto update: Fetch latest ZipZAP M3U from PHP source"
      # Push etmeden Ã¶nce olasÄ± Ã§akÄ±ÅŸmalarÄ± Ã§Ã¶zmek iÃ§in rebase yap
      git pull --rebase
      # Tetikleyen dala (HEAD) push et
      git push origin HEAD
